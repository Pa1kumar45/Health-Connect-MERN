# Health-Connect - Architecture Diagrams for Interviews

## ğŸ¨ Visual Reference Guide

This document contains ASCII diagrams and visual explanations to use during technical interviews. Draw these on whiteboards or share your screen.

---

## ğŸ“Š Diagram 1: Overall System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HEALTH-CONNECT PLATFORM                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DOCTOR CLIENT      â”‚                    â”‚   PATIENT CLIENT     â”‚
â”‚  (React + TS)        â”‚                    â”‚   (React + TS)       â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Video Call UI â”‚  â”‚                    â”‚  â”‚  Video Call UI â”‚  â”‚
â”‚  â”‚  Chat UI       â”‚  â”‚                    â”‚  â”‚  Chat UI       â”‚  â”‚
â”‚  â”‚  Appointments  â”‚  â”‚                    â”‚  â”‚  Doctor List   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                    â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Socket.IO Clientâ”‚â—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â–ºâ”‚Socket.IO Clientâ”‚  â”‚
â”‚  â”‚WebRTC (P2P)    â”‚  â”‚        â”‚  â”‚        â”‚  â”‚WebRTC (P2P)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚  â”‚        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                                 â”‚
         â–¼                                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND SERVER (Node.js)                         â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Express.js      â”‚  â”‚  Socket.IO       â”‚  â”‚  JWT Auth        â”‚ â”‚
â”‚  â”‚  REST API        â”‚  â”‚  WebSocket       â”‚  â”‚  Middleware      â”‚ â”‚
â”‚  â”‚  - /api/auth     â”‚  â”‚  - Signaling     â”‚  â”‚  - protect()     â”‚ â”‚
â”‚  â”‚  - /api/doctors  â”‚  â”‚  - Chat          â”‚  â”‚  - doctorOnly()  â”‚ â”‚
â”‚  â”‚  - /api/patients â”‚  â”‚  - User tracking â”‚  â”‚  - patientOnly() â”‚ â”‚
â”‚  â”‚  - /api/messages â”‚  â”‚                  â”‚  â”‚                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Controllers     â”‚                         â”‚  Models          â”‚ â”‚
â”‚  â”‚  - Auth          â”‚                         â”‚  - Doctor        â”‚ â”‚
â”‚  â”‚  - Appointments  â”‚                         â”‚  - Patient       â”‚ â”‚
â”‚  â”‚  - Messages      â”‚                         â”‚  - Appointment   â”‚ â”‚
â”‚  â”‚  - Doctors       â”‚                         â”‚  - Message       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                 â”‚
         â–¼                                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MongoDB            â”‚                    â”‚   Cloudinary         â”‚
â”‚   - doctors          â”‚                    â”‚   - Image Storage    â”‚
â”‚   - patients         â”‚                    â”‚   - CDN Delivery     â”‚
â”‚   - appointments     â”‚                    â”‚   - Transform API    â”‚
â”‚   - messages         â”‚                    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DIRECT P2P CONNECTION (Media Streams - No Server)
Doctor Client â—„â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–º Patient Client
              Video/Audio flows peer-to-peer via WebRTC
              (Server only used for initial signaling)
```

**Key Points to Explain:**

- Frontend: React + TypeScript SPAs with real-time context providers
- Backend: Express REST API + Socket.IO WebSocket server
- Database: MongoDB for persistence, Cloudinary for media
- P2P: Video/audio streams bypass server after connection established

---

## ğŸ“Š Diagram 2: WebRTC Call Flow (Step-by-Step)

```
INITIATOR (Doctor)                 SIGNALING SERVER           RECEIVER (Patient)
                                    (Socket.IO)
     â”‚                                   â”‚                          â”‚
     â”‚ 1. Click "Call"                   â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚ 2. Get Local Media                â”‚                          â”‚
     â”‚    getUserMedia()                 â”‚                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚ 3. Create RTCPeerConnection       â”‚                          â”‚
     â”‚    Add local tracks               â”‚                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚ 4. Create SDP Offer               â”‚                          â”‚
     â”‚    setLocalDescription(offer)     â”‚                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚ 5. Send Offer                     â”‚                          â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€[call-user]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
     â”‚                                   â”‚ 6. Forward Offer         â”‚
     â”‚                                   â”‚â”€â”€â”€â”€â”€[call-made]â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚          7. Show Incomingâ”‚
     â”‚                                   â”‚             Call UI      â”‚
     â”‚                                   â”‚                   â—„â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚          8. User Clicks  â”‚
     â”‚                                   â”‚             "Answer"     â”‚
     â”‚                                   â”‚                   â—„â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚          9. Get Local    â”‚
     â”‚                                   â”‚             Media        â”‚
     â”‚                                   â”‚                   â—„â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚         10. Create Peer  â”‚
     â”‚                                   â”‚             Connection   â”‚
     â”‚                                   â”‚                   â—„â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚         11. Set Remote   â”‚
     â”‚                                   â”‚             Description  â”‚
     â”‚                                   â”‚             (offer)      â”‚
     â”‚                                   â”‚                   â—„â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚         12. Create SDP   â”‚
     â”‚                                   â”‚             Answer       â”‚
     â”‚                                   â”‚                   â—„â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚         13. Send Answer  â”‚
     â”‚                                   â”‚â—„â”€â”€â”€[answer-call]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚ 14. Receive Answer                â”‚                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€[call-answered]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚ 15. Set Remote Description        â”‚                          â”‚
     â”‚     (answer)                      â”‚                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€[ICE Candidates Exchange]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚         (via ice-candidate events)                           â”‚
     â”‚                                   â”‚                          â”‚
     â”‚                                   â”‚                          â”‚
     â”‚ 16. ICE Negotiation Complete      â”‚                          â”‚
     â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
     â”‚           DIRECT P2P CONNECTION ESTABLISHED                  â”‚
     â”‚              (Audio/Video Streams)                           â”‚
     â”‚â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
     â”‚                                   â”‚                          â”‚
```

**Timing Breakdown:**

- Steps 1-5: ~50ms (offer creation)
- Steps 6-13: ~100-200ms (answer creation)
- Steps 14-15: ~50ms (remote description)
- Step 16 (ICE): ~500-2000ms (NAT traversal)
- **Total**: ~700-2300ms to connected state

**Critical Points:**

- **SDP Exchange**: Describes media capabilities (codecs, bandwidth)
- **ICE Candidates**: Network addresses for P2P connection
- **Signaling Role**: Server only forwards messages, never sees media
- **Buffering**: Candidates stored if remote description not ready

---

## ğŸ“Š Diagram 3: Socket.IO Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SOCKET.IO SERVER                             â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  onlineUsers = Map<userId, socketId>                       â”‚   â”‚
â”‚  â”‚  - doctor123 â†’ socket_abc                                  â”‚   â”‚
â”‚  â”‚  - patient456 â†’ socket_def                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EVENT: connection
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€[connect with userId]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Server  â”‚
â”‚          â”‚                                         â”‚          â”‚
â”‚          â”‚                                         â”‚  Store   â”‚
â”‚          â”‚                                         â”‚  mapping â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EVENT: call-user (WebRTC Signaling)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Caller   â”‚â”€â”€â”€â”€[{to: patientId, offer: SDP}]â”€â”€â”€â”€â”€â”€â–ºâ”‚  Server  â”‚
â”‚          â”‚                                         â”‚          â”‚
â”‚          â”‚                                         â”‚ Lookup   â”‚
â”‚          â”‚                                         â”‚ socketId â”‚
â”‚          â”‚                                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â”‚          â”‚                                               â”‚
â”‚          â”‚                                               â–¼
â”‚          â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚â—„â”€â”€â”€â”€â”€[call-made: {from, offer}]â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Receiver â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EVENT: newMessage (Chat)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sender  â”‚â”€â”€â”€â”€[{text, receiverId}]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Server  â”‚
â”‚          â”‚                                         â”‚          â”‚
â”‚          â”‚                                         â”‚ 1. Save  â”‚
â”‚          â”‚                                         â”‚    to DB â”‚
â”‚          â”‚                                         â”‚ 2. Lookupâ”‚
â”‚          â”‚                                         â”‚    socketâ”‚
â”‚          â”‚                                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â”‚          â”‚                                               â”‚
â”‚          â”‚                                               â–¼
â”‚          â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚â—„â”€â”€â”€â”€â”€[newMessage: message obj]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Receiver â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EVENT: ice-candidate (ICE Exchange)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Peer A  â”‚â”€â”€â”€â”€[{to: userId, candidate}]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Server  â”‚
â”‚          â”‚                                         â”‚          â”‚
â”‚          â”‚                                         â”‚ Forward  â”‚
â”‚          â”‚                                         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â”‚          â”‚                                               â”‚
â”‚          â”‚                                               â–¼
â”‚          â”‚                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚â—„â”€â”€â”€â”€â”€[ice-candidate: {candidate}]â”€â”€â”€â”€â”€â”€â”‚  Peer B  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EVENT: disconnect
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client  â”‚â”€â”€â”€â”€[connection lost]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Server  â”‚
â”‚          â”‚                                         â”‚          â”‚
â”‚          â”‚                                         â”‚ Remove   â”‚
â”‚          â”‚                                         â”‚ from Map â”‚
â”‚          â”‚                                         â”‚          â”‚
â”‚          â”‚â—„â”€â”€â”€â”€â”€[auto-reconnect attempt]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Configuration:**

```javascript
{
  pingTimeout: 60000,      // 60s max silence before disconnect
  pingInterval: 25000,     // 25s heartbeat
  reconnection: true,      // Auto-reconnect
  reconnectionAttempts: 5, // Max retry
  reconnectionDelay: 1000  // 1s between retries
}
```

---

## ğŸ“Š Diagram 4: MongoDB Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MONGODB COLLECTIONS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       DOCTORS           â”‚         â”‚       PATIENTS          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ _id: ObjectId           â”‚         â”‚ _id: ObjectId           â”‚
â”‚ name: String            â”‚         â”‚ name: String            â”‚
â”‚ email: String (indexed) â”‚         â”‚ email: String (indexed) â”‚
â”‚ specialization: String  â”‚         â”‚ dateOfBirth: String     â”‚
â”‚ qualification: String   â”‚         â”‚ gender: String          â”‚
â”‚ experience: Number      â”‚         â”‚ bloodGroup: String      â”‚
â”‚ schedule: [             â”‚         â”‚ allergies: String       â”‚
â”‚   {                     â”‚         â”‚ emergencyContact: [     â”‚
â”‚     day: String,        â”‚         â”‚   {                     â”‚
â”‚     slots: [            â”‚         â”‚     name: String,       â”‚
â”‚       {                 â”‚         â”‚     relationship: Stringâ”‚
â”‚         slotNumber: #,  â”‚         â”‚     phone: String       â”‚
â”‚         startTime: "HH" â”‚         â”‚   }                     â”‚
â”‚         endTime: "HH",  â”‚         â”‚ ]                       â”‚
â”‚         isAvailable: â˜‘  â”‚         â”‚                         â”‚
â”‚       }                 â”‚         â”‚                         â”‚
â”‚     ]                   â”‚         â”‚                         â”‚
â”‚   }                     â”‚         â”‚                         â”‚
â”‚ ]                       â”‚         â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                   â”‚
          â”‚         REFERENCED BY             â”‚
          â”‚              (1:N)                â”‚
          â”‚                                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        APPOINTMENTS              â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚ _id: ObjectId                    â”‚
          â”‚ doctorId: ObjectId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º doctors._id
          â”‚ patientId: ObjectId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º patients._id
          â”‚ date: String                     â”‚
          â”‚ startTime: String                â”‚
          â”‚ endTime: String                  â”‚
          â”‚ status: pending|scheduled|...    â”‚
          â”‚ mode: video|chat                 â”‚
          â”‚ reason: String (patient input)   â”‚
          â”‚ comment: String (doctor input)   â”‚
          â”‚ notes: String (medical record)   â”‚
          â”‚ rating: Number                   â”‚
          â”‚ review: String                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          INDEX: doctorId + date + startTime
          INDEX: patientId + date + startTime
          INDEX: status + date


          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚          MESSAGES                â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚ _id: ObjectId                    â”‚
          â”‚ senderId: ObjectId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º doctors._id OR patients._id
          â”‚ receiverId: ObjectId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º doctors._id OR patients._id
          â”‚ text: String                     â”‚
          â”‚ image: String (Cloudinary URL)   â”‚
          â”‚ type: text|image                 â”‚
          â”‚ read: Boolean                    â”‚
          â”‚ createdAt: Date                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          INDEX: senderId + receiverId + createdAt
          INDEX: receiverId + read


EMBEDDED vs REFERENCED STRATEGY:

âœ… EMBEDDED (1:N with bounded N):
   - Doctor.schedule (max 7 days Ã— 20 slots = 140)
   - Patient.emergencyContact (typically 1-3)
   - Always accessed together
   - Strong data locality

âœ… REFERENCED (M:N or unbounded):
   - Appointments (many doctors Ã— many patients)
   - Messages (unbounded growth)
   - Independent query patterns
   - Flexible relationships
```

---

## ğŸ“Š Diagram 5: ICE Candidate Race Condition & Solution

```
PROBLEM: Race Condition (15% failures)

Timeline without buffering:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  t=0      t=50     t=100    t=150    t=200    t=250
  â”‚        â”‚        â”‚        â”‚        â”‚        â”‚
  Offer    ICE #1   ICE #2   Answer   ICE #3   ICE #4
  sent     arrives  arrives  arrives  arrives  arrives
           âŒ        âŒ        âœ“        âœ“        âœ“
           FAILS    FAILS    Sets     OK       OK
           (no remote description yet)

Result: First 2 ICE candidates lost â†’ Connection may fail


SOLUTION: Buffering Mechanism (2% failures)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PEER CONNECTION STATE                          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  remoteDescription: null                                    â”‚
â”‚  pendingCandidates: []                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Timeline with buffering:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  t=0      t=50     t=100    t=150    t=200    t=250
  â”‚        â”‚        â”‚        â”‚        â”‚        â”‚
  Offer    ICE #1   ICE #2   Answer   ICE #3   ICE #4
  sent     arrives  arrives  arrives  arrives  arrives

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ t=50: ICE #1 arrives                                        â”‚
â”‚   if (remoteDescription) {                                  â”‚
â”‚     âŒ FALSE â†’ Buffer it                                     â”‚
â”‚     pendingCandidates.push(ICE #1)                          â”‚
â”‚   }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ t=100: ICE #2 arrives                                       â”‚
â”‚   if (remoteDescription) {                                  â”‚
â”‚     âŒ FALSE â†’ Buffer it                                     â”‚
â”‚     pendingCandidates.push(ICE #2)                          â”‚
â”‚   }                                                         â”‚
â”‚   pendingCandidates = [ICE #1, ICE #2]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ t=150: Answer arrives                                       â”‚
â”‚   setRemoteDescription(answer) âœ“                            â”‚
â”‚   // Now apply buffered candidates                          â”‚
â”‚   pendingCandidates.forEach(candidate => {                  â”‚
â”‚     peerConnection.addIceCandidate(candidate) âœ“             â”‚
â”‚   })                                                        â”‚
â”‚   pendingCandidates = []  // Clear buffer                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ t=200: ICE #3 arrives                                       â”‚
â”‚   if (remoteDescription) {                                  â”‚
â”‚     âœ… TRUE â†’ Add directly                                   â”‚
â”‚     peerConnection.addIceCandidate(ICE #3) âœ“                â”‚
â”‚   }                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: All ICE candidates applied â†’ Connection succeeds

CODE:
const pendingCandidatesRef = useRef<RTCIceCandidate[]>([]);

socket.on('ice-candidate', (data) => {
    const candidate = new RTCIceCandidate(data.candidate);

    if (peerConnection.remoteDescription) {
        peerConnection.addIceCandidate(candidate);  // Direct add
    } else {
        pendingCandidatesRef.current.push(candidate);  // Buffer
    }
});

// After setting remote description:
pendingCandidatesRef.current.forEach(candidate => {
    peerConnection.addIceCandidate(candidate);
});
pendingCandidatesRef.current = [];  // Clear
```

---

## ğŸ“Š Diagram 6: Authentication & Authorization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. REGISTRATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Client â”‚â”€â”€[POST /api/auth/register]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Server â”‚
   â”‚        â”‚  {name, email, password, role}          â”‚        â”‚
   â”‚        â”‚                                          â”‚ Bcrypt â”‚
   â”‚        â”‚                                          â”‚ hash   â”‚
   â”‚        â”‚                                          â”‚ (14)   â”‚
   â”‚        â”‚                                          â”‚        â”‚
   â”‚        â”‚â—„â”€[Set-Cookie: token=JWT]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ MongoDBâ”‚
   â”‚        â”‚  {user data, role}                      â”‚ Save   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Stores JWT in     JWT = {id, role, exp: 7d}     HTTP-only cookie
   HTTP-only cookie  Signed with JWT_SECRET         sameSite=strict

2. LOGIN
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Client â”‚â”€â”€[POST /api/auth/login]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Server â”‚
   â”‚        â”‚  {email, password, role}                â”‚        â”‚
   â”‚        â”‚                                          â”‚ Find   â”‚
   â”‚        â”‚                                          â”‚ user   â”‚
   â”‚        â”‚                                          â”‚ Bcrypt â”‚
   â”‚        â”‚                                          â”‚ compareâ”‚
   â”‚        â”‚â—„â”€[Set-Cookie: token=JWT]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚
   â”‚        â”‚  {user data, role}                      â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. PROTECTED REQUEST
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Client â”‚â”€â”€[GET /api/appointments]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Server â”‚
   â”‚        â”‚  Cookie: token=JWT                      â”‚        â”‚
   â”‚        â”‚                                          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
   â”‚        â”‚                                          â”‚ â”‚ Middleware  â”‚
   â”‚        â”‚                                          â”‚ â”‚ protect()   â”‚
   â”‚        â”‚                                          â”‚ â”‚             â”‚
   â”‚        â”‚                                          â”‚ â”‚ 1. Verify   â”‚
   â”‚        â”‚                                          â”‚ â”‚    JWT      â”‚
   â”‚        â”‚                                          â”‚ â”‚ 2. Decode   â”‚
   â”‚        â”‚                                          â”‚ â”‚    {id,role}â”‚
   â”‚        â”‚                                          â”‚ â”‚ 3. Fetch    â”‚
   â”‚        â”‚                                          â”‚ â”‚    user     â”‚
   â”‚        â”‚                                          â”‚ â”‚ 4. Attach   â”‚
   â”‚        â”‚                                          â”‚ â”‚    req.user â”‚
   â”‚        â”‚                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚        â”‚                                          â”‚        â”‚
   â”‚        â”‚â—„â”€[200 OK with data]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Controller
   â”‚        â”‚                                          â”‚ accesses
   â”‚        â”‚                                          â”‚ req.user
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. ROLE-BASED AUTHORIZATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Doctor â”‚â”€â”€[POST /api/appointments/:id]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Server â”‚
   â”‚ Client â”‚  Cookie: token=JWT                      â”‚        â”‚
   â”‚        â”‚  {status: "scheduled"}                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
   â”‚        â”‚                                          â”‚ â”‚ protect()   â”‚
   â”‚        â”‚                                          â”‚ â”‚ âœ“ JWT valid â”‚
   â”‚        â”‚                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚        â”‚                                          â”‚        â”‚
   â”‚        â”‚                                          â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚        â”‚                                          â”‚ â”‚doctorOnly() â”‚
   â”‚        â”‚                                          â”‚ â”‚             â”‚
   â”‚        â”‚                                          â”‚ â”‚if (role !=  â”‚
   â”‚        â”‚                                          â”‚ â”‚  'doctor')  â”‚
   â”‚        â”‚                                          â”‚ â”‚  403 Denied â”‚
   â”‚        â”‚                                          â”‚ â”‚else proceed â”‚
   â”‚        â”‚                                          â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚        â”‚                                          â”‚        â”‚
   â”‚        â”‚â—„â”€[200 OK]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Controller
   â”‚        â”‚                                          â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Patient tries same request â†’ 403 Forbidden


SECURITY LAYERS:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. Password: Bcrypt hashed (12-14 rounds)
2. Token: JWT signed with secret
3. Storage: HTTP-only cookie (XSS protection)
4. Flags: secure=true, sameSite=strict
5. Expiry: 7 days
6. Verification: Every protected route
7. Authorization: Role-based middleware
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ¨ How to Use These Diagrams in Interviews

### **On Whiteboard:**

1. Start with Diagram 1 (Overall Architecture) to show big picture
2. Drill into Diagram 2 (WebRTC Flow) when discussing video calls
3. Use Diagram 5 (Race Condition) to show problem-solving depth

### **On Paper:**

- Draw simplified versions with boxes and arrows
- Use colors if available (green=success, red=error)
- Add annotations with numbers for sequence

### **Verbally:**

- "Let me sketch this out for you..."
- "There are three main components here..."
- "The flow goes like this: first... then... finally..."

### **Key Phrases:**

- "As you can see in this diagram..."
- "This is where the challenge was..."
- "Notice how X connects to Y here..."
- "The critical part is this bottleneck..."

---

## ğŸ’¡ Practice Tips

1. **Draw from memory** without looking at references
2. **Explain while drawing** to practice multitasking
3. **Time yourself** - aim for 60 seconds per diagram
4. **Use consistent symbols** (circles for entities, arrows for flow)
5. **Add legends** to clarify icons and colors

---

**Master these visual explanations to demonstrate your deep understanding of the system architecture!** ğŸ¨âœ¨
